<!DOCTYPE html>
<html lang="pt-br">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="stylesheet" href="./CSS/estiloBase.css">
  <link rel="stylesheet" href="./CSS/pacientes.css">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css">
  <title>Agendamento de Exames</title>
</head>
<body>
  <!-- Menu lateral -->
  <div class="sidebar" id="sidebar">
    <button class="toggle-btn" onclick="toggleSidebar()" aria-label="Abrir menu lateral">
      <i class="bi bi-list"></i>
    </button>
    <ul>
      <li><a href="./Home.html"><i class="bi bi-house-door"></i><span>Início</span></a></li>
      <li><a href="./Consulta.html"><i class="bi bi-clipboard"></i><span>Consultas</span></a></li>
      <li><a href="./Agendamento.html"><i class="bi bi-calendar"></i><span>Agendamentos</span></a></li>
      <li><a href="./Exames.html"><i class="bi bi-file-earmark-medical"></i><span>Exames</span></a></li>
      <li><a href="./Pacientes.html"><i class="bi bi-person"></i><span>Pacientes</span></a></li>
      <li><a href="#"><i class="bi bi-people"></i><span>Equipe</span></a></li>
      <li><a href="#"><i class="bi bi-bar-chart"></i><span>Relatórios</span></a></li>
      <li><a href="#"><i class="bi bi-gear"></i><span>Configurações</span></a></li>
    </ul>
  </div>

  <!-- Área principal -->
  <div class="main-content">
    <div class="header">
      <h1>Cadastro de pacientes</h1>
      <div class="search-bar">
        <input type="text" id="search-button" placeholder="Buscar..." aria-label="Buscar" />
        <button><i class="bi bi-search"></i></button>
      </div>
      <div class="theme-switcher">
        <button class="theme-button" onclick="alternarMenu()" aria-label="Alternar tema"><i class="bi bi-moon-stars-fill"></i></button>
        <div class="dropdown" id="dropdown-tema">
          <div class="dropdown-item" onclick="definirTema('light')"><i class="bi bi-sun-fill"></i></div>
          <div class="dropdown-item" onclick="definirTema('dark')"><i class="bi bi-moon-stars-fill"></i></div>
        </div>
      </div>
    </div>

    <div class="content">
      <!-- Formulário de cadastro -->
      <div class="form-section">
        <form id="cadastroForm">
          <div>
            <label for="nomeTutor">Nome do Tutor:</label>
            <input type="text" id="nomeTutor" placeholder="Digite o nome do tutor" required>
          </div>
          <div>
            <label for="telefoneTutor">Telefone:</label>
            <input type="tel" id="telefoneTutor" placeholder="Digite o telefone" required>
          </div>
          <div>
            <label for="emailTutor">E-mail:</label>
            <input type="email" id="emailTutor" placeholder="Digite o e-mail">
          </div>
          <div>
            <label for="nomePet">Nome do Pet:</label>
            <input type="text" id="nomePet" placeholder="Digite o nome do pet" required>
          </div>
          <div>
            <label for="especie">Espécie:</label>
            <select id="especie" required>
              <option value="">Selecione</option>
              <option value="Cachorro">Cachorro</option>
              <option value="Gato">Gato</option>
              <option value="Outros">Outros</option>
            </select>
          </div>
          <div>
            <label for="peso">Peso (kg):</label>
            <input type="number" id="peso" step="0.1" placeholder="Digite o peso do pet" required>
          </div>
          <div>
            <label for="fotoPet">Foto do Pet:</label>
            <input type="file" id="fotoPet" accept="image/*">
          </div>
          <button type="button" onclick="exibirDados()">Salvar</button>
        </form>
      </div>

      <!-- Exibição dos dados -->
      <div class="result-section" id="resultSection">
        <h2>Dados do Cadastro</h2>
        <div id="result"></div>
      </div>
    </div>

    <footer>
      <p>&copy; 2024 Clínica Veterinária Agro Suaçuna</p>
    </footer>
  </div>

  <script src="./JS/tema.js"></script>
  <script src="./JS/pesquisa.js"></script>
  <script>
    function exibirDados() {
        const nomeTutor = document.getElementById('nomeTutor').value;
        const telefoneTutor = document.getElementById('telefoneTutor').value;
        const emailTutor = document.getElementById('emailTutor').value || "Não informado";
        const nomePet = document.getElementById('nomePet').value;
        const especie = document.getElementById('especie').value;
        const peso = document.getElementById('peso').value || "kg";
        const fotoPet = document.getElementById('fotoPet').files[0];
    
        const resultDiv = document.getElementById('result');
    
        let fotoPetUrl = '';
        if (fotoPet) {
            fotoPetUrl = URL.createObjectURL(fotoPet);
        }
    
        // Verifica se está editando um cadastro
        const editIndex = document.getElementById("cadastroForm").dataset.editIndex;
        if (editIndex) {
            const pacienteDiv = document.getElementsByClassName("paciente-card")[editIndex];
            pacienteDiv.innerHTML = `
                <div class="texto">
                    <h3>Pet: ${nomePet} (${especie})</h3>
                    <p><strong>Tutor:</strong> ${nomeTutor}</p>
                    <p><strong>Telefone:</strong> ${telefoneTutor}</p>
                    <p><strong>E-mail:</strong> ${emailTutor}</p>
                    <p><strong>Peso:</strong> ${peso} kg</p>
                </div>
                ${fotoPetUrl ? `<img src="${fotoPetUrl}" alt="Foto de ${nomePet}" class="foto-pet">` : ''}
                <button class="edit-btn" onclick="editarCadastro('${editIndex}')">Editar</button>
            `;
            delete document.getElementById("cadastroForm").dataset.editIndex; // Remove estado de edição
        } else {
            const pacienteDiv = document.createElement('div');
            pacienteDiv.classList.add('paciente-card');
            pacienteDiv.innerHTML = `
                <div class="texto">
                    <h3>Pet: ${nomePet} (${especie})</h3>
                    <p><strong>Tutor:</strong> ${nomeTutor}</p>
                    <p><strong>Telefone:</strong> ${telefoneTutor}</p>
                    <p><strong>E-mail:</strong> ${emailTutor}</p>
                    <p><strong>Peso:</strong> ${peso} kg</p>
                </div>
                ${fotoPetUrl ? `<img src="${fotoPetUrl}" alt="Foto de ${nomePet}" class="foto-pet">` : ''}
                <button class="edit-btn" onclick="editarCadastro('${resultDiv.childElementCount}')">Editar</button>
            `;
            resultDiv.appendChild(pacienteDiv);
        }
    
        document.getElementById('cadastroForm').reset();
    }

    function carregarPacientes() {
        const xhr = new XMLHttpRequest();
        xhr.open("GET", "./XML/pacientes.xml", true);
        xhr.onreadystatechange = function () {
            if (xhr.readyState === 4 && xhr.status === 200) {
                const xml = xhr.responseXML;
                const pacientes = xml.getElementsByTagName("paciente");
                const resultSection = document.getElementById("result");
                resultSection.innerHTML = ""; // Limpa resultados anteriores
    
                for (let i = 0; i < pacientes.length; i++) {
                    const paciente = pacientes[i];
                    const nomeTutor = paciente.getElementsByTagName("nomeTutor")[0]?.textContent || "Não informado";
                    const telefoneTutor = paciente.getElementsByTagName("telefoneTutor")[0]?.textContent || "Não informado";
                    const emailTutor = paciente.getElementsByTagName("emailTutor")[0]?.textContent || "Não informado";
                    const nomePet = paciente.getElementsByTagName("nomePet")[0]?.textContent || "Desconhecido";
                    const especie = paciente.getElementsByTagName("especie")[0]?.textContent || "Não especificado";
                    const peso = paciente.getElementsByTagName("peso")[0]?.textContent || "kg";
                    const fotoPet = paciente.getElementsByTagName("fotoPet")[0]?.textContent; // URL da foto (se disponível)
    
                    // Use ícone do Bootstrap se não houver foto
                    const fotoPetHtml = fotoPet
                        ? `<img src="${fotoPet}" alt="Foto de ${nomePet}" class="foto-pet">`
                        : `<i class="bi bi-person-circle foto-pet"></i>`; // Ícone do Bootstrap
    
                    const pacienteDiv = document.createElement("div");
                    pacienteDiv.classList.add("paciente-card");
                    pacienteDiv.innerHTML = `
                        <div class="texto">
                            <h3>Pet: ${nomePet} (${especie})</h3>
                            <p><strong>Tutor:</strong> ${nomeTutor}</p>
                            <p><strong>Telefone:</strong> ${telefoneTutor}</p>
                            <p><strong>E-mail:</strong> ${emailTutor}</p>
                            <p><strong>Peso:</strong> ${peso} kg</p>
                        </div>
                        ${fotoPetHtml}
                    `;
    
                    resultSection.appendChild(pacienteDiv);
                }
            }
        };
        xhr.send();
    }
    
    // Carregar os pacientes automaticamente ao abrir a página
    document.addEventListener("DOMContentLoaded", carregarPacientes);

    function editarCadastro(index) {
        const pacientes = document.getElementsByClassName("paciente-card");
        const paciente = pacientes[index];
        
        // Recupera os valores exibidos no cadastro
        const nomeTutor = paciente.querySelector('p:nth-child(2)').textContent.replace("Tutor: ", "");
        const telefoneTutor = paciente.querySelector('p:nth-child(3)').textContent.replace("Telefone: ", "");
        const emailTutor = paciente.querySelector('p:nth-child(4)').textContent.replace("E-mail: ", "");
        const nomePet = paciente.querySelector('h3').textContent.split(": ")[1].split(" (")[0];
        const especie = paciente.querySelector('h3').textContent.split("(")[1].replace(")", "");
        const peso = paciente.querySelector('p:nth-child(5)').textContent.replace("Peso: ", "").replace(" kg", "");
    
        // Preenche o formulário com os dados do paciente
        document.getElementById("nomeTutor").value = nomeTutor;
        document.getElementById("telefoneTutor").value = telefoneTutor;
        document.getElementById("emailTutor").value = emailTutor;
        document.getElementById("nomePet").value = nomePet;
        document.getElementById("especie").value = especie;
        document.getElementById("peso").value = peso;
    
        // Define o índice de edição no formulário
        document.getElementById("cadastroForm").dataset.editIndex = index;
    
        // Desloca a página para o formulário para facilitar a edição
        document.getElementById("cadastroForm").scrollIntoView({ behavior: "smooth" });
    }
  </script>
</body>
</html>
